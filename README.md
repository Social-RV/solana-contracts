# Social RV - Solana Contracts

This repository contains the open-source Solana smart contracts and SDK for [Social RV](https://socialrv.com), a platform for provably blind remote viewing sessions.

**[Verify Sessions →](https://social-rv.com/verify)** — Interactive UI to explore how the blockchain verification works and verify any session.

## Overview

These contracts enable cryptographically verifiable blind target assignment for remote viewing sessions. The key guarantee: **nobody can know what target will be assigned until after a session is submitted**.

## Repository Structure

```
├── solana-program/     # Rust smart contract (deployed on Solana)
│   ├── src/
│   │   └── lib.rs      # Main program logic
│   ├── Cargo.toml
│   └── Cargo.lock
│
└── sdk/                # TypeScript SDK for interacting with the contract
    ├── remote-viewing-sdk.ts          # Main SDK
    ├── types.ts                       # TypeScript types
    └── solana-transaction-decoders.ts # Decode on-chain data
```

## Deployed Program

| Network | Program ID                                     |
| ------- | ---------------------------------------------- |
| Mainnet | `AgdxtGStJsyCZAZvZChtnTtaK774e3Yf2QWdq8gSfLuc` |

## How It Works

### Two-Transaction Flow

The blindness guarantee comes from a two-transaction process:

1. **SubmitSession** - Records the session media hash on-chain. At this moment, the blockhash that will be used for target selection doesn't exist yet.

2. **FinalizeSession** - Uses the blockhash from the submission slot to deterministically select a target. This blockhash was unpredictable when the session was submitted.

### Key Mechanisms

- **Blockhash Randomness**: Target selection uses Solana blockhashes, which are generated by the validator network and are cryptographically unpredictable.
- **Hash Commitments**: Session media is hashed before submission, locking in the content.
- **Immutable Pools**: Target pools are finalized before sessions can be submitted, preventing manipulation.
- **On-Chain Verification**: All data is stored on Solana and can be independently verified.

### Pool Creation Flow

Before sessions can be submitted, a target pool must be created and locked. This is a three-step process:

1. **CreateTargetPool** - Creates a new pool with an initial set of target hashes (can be empty).

2. **AppendTargetsToPool** - Uploads additional target hashes to the pool. This can be called multiple times to batch-upload targets. Only the original pool creator can append targets.

3. **FinalizePool** - Locks the pool, preventing any further target additions. Once finalized, the pool is immutable and sessions can be submitted against it.

```
┌──────────────────┐     ┌─────────────────────┐     ┌──────────────┐
│ CreateTargetPool │ ──▶ │ AppendTargetsToPool │ ──▶ │ FinalizePool │
│   (initialize)   │     │   (repeat as needed) │     │    (lock)    │
└──────────────────┘     └─────────────────────┘     └──────────────┘
```

**Why this flow?**

- Allows batch uploading of large target sets across multiple transactions
- The finalization step ensures all targets are committed before any sessions begin
- Only the pool creator can modify or finalize the pool
- Once finalized, the pool cannot be altered, guaranteeing fair target selection

## Building

### Prerequisites

- Rust and Cargo
- Solana CLI tools (v1.18+)

### Build the Program

```bash
cd solana-program
cargo build-sbf
```

## SDK Usage

The TypeScript SDK provides methods to interact with the deployed program:

```typescript
import { RemoteViewingSDK } from "./sdk/remote-viewing-sdk";

const sdk = new RemoteViewingSDK(
  "https://api.mainnet-beta.solana.com",
  "AgdxtGStJsyCZAZvZChtnTtaK774e3Yf2QWdq8gSfLuc",
  privateKey,
  "mainnet"
);

// Verify a session's integrity
const result = await sdk.verifySessionIntegrity(sessionId);
console.log(result.valid); // true if all checks pass
```

## Data Decoders

The `solana-transaction-decoders.ts` file provides functions to decode on-chain data:

- `decodePoolAccount(base64)` - Decode target pool account data
- `decodeSessionAccount(base64)` - Decode session account data
- `decodeSubmitSessionInstruction(hex)` - Decode submit instruction
- `decodeFinalizeSessionInstruction(hex)` - Decode finalize instruction

## License

MIT License - See LICENSE file for details.
